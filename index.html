<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KING PONG ULTIMATE | PROFESSIONAL GRADE</title>
    <style>
        :root {
            --primary: #00f2ff;
            --secondary: #ff007f;
            --success: #39ff14;
            --warning: #ffbd00;
            --bg-black: #030303;
            --font-main: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        * { box-sizing: border-box; outline: none; }

        body {
            background: var(--bg-black);
            color: #fff;
            font-family: var(--font-main);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            user-select: none;
        }

        /* Camada de efeito Retro CRT (Scanlines) */
        body::before {
            content: " ";
            display: block;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), 
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 200;
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
        }

        /* Container Principal */
        #game-container {
            position: relative;
            width: 1000px;
            height: 600px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* HUD - Interface em Tempo Real */
        #game-hud {
            position: absolute;
            top: 0; left: 0; width: 100%;
            display: none;
            justify-content: space-between;
            padding: 30px 60px;
            z-index: 50;
            pointer-events: none;
        }

        .hud-player { text-align: center; }
        .score-num { 
            font-size: 6rem; 
            font-weight: 900; 
            margin: 0; 
            line-height: 1;
            font-variant-numeric: tabular-nums;
            filter: drop-shadow(0 0 10px currentColor);
        }
        .player-label { font-size: 12px; letter-spacing: 3px; opacity: 0.6; text-transform: uppercase; margin-top: 5px; }

        /* Telas de Overlay */
        .screen {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.92);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            backdrop-filter: blur(10px);
            transition: opacity 0.5s ease;
        }

        .screen.hidden { 
            opacity: 0; 
            pointer-events: none; 
            display: none; /* Força remoção para evitar bugs */
        }

        .panel {
            background: #0a0a0a;
            padding: 50px 70px;
            border-radius: 40px;
            border: 1px solid #222;
            text-align: center;
            position: relative;
            box-shadow: 0 30px 60px rgba(0,0,0,0.8);
        }

        .panel::after {
            content: ''; position: absolute; inset: -2px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            z-index: -1; border-radius: 42px; opacity: 0.3;
        }

        h1 { 
            font-size: 4.5rem; 
            margin: 0; 
            background: linear-gradient(to right, #fff, #666); 
            -webkit-background-clip: text; 
            -webkit-text-fill-color: transparent;
            letter-spacing: -2px;
        }

        .menu-options {
            margin-top: 40px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 280px;
        }

        /* Botões Estilizados */
        .btn-king {
            background: #151515;
            color: #fff;
            border: 1px solid #333;
            padding: 20px;
            border-radius: 15px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .btn-king:hover {
            background: #fff;
            color: #000;
            transform: scale(1.05) translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 242, 255, 0.2);
        }

        .btn-king:active { transform: scale(0.98); }

        /* Notificações in-game */
        #notification-box {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            pointer-events: none;
        }

        .toast {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(5px);
            padding: 10px 30px;
            border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.2);
            font-weight: bold;
            font-size: 14px;
            color: var(--success);
            animation: slideUp 2s forwards;
            white-space: nowrap;
        }

        @keyframes slideUp {
            0% { transform: translateY(20px); opacity: 0; }
            20% { transform: translateY(0); opacity: 1; }
            80% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-20px); opacity: 0; }
        }

        /* Canvas Arena */
        canvas {
            background: #000;
            display: none;
            border-radius: 4px;
            box-shadow: 0 0 40px rgba(0,0,0,1);
        }

        /* Mensagens de Impacto */
        #announcer {
            position: absolute;
            font-size: 8rem;
            font-weight: 900;
            font-style: italic;
            z-index: 60;
            opacity: 0;
            pointer-events: none;
            text-transform: uppercase;
        }

    </style>
</head>
<body>

    <div id="game-container">
        
        <div id="game-hud">
            <div class="hud-player">
                <div class="player-label">Academy Cadet</div>
                <div id="score-p1" class="score-num" style="color: var(--primary)">0</div>
            </div>
            <div style="align-self: center; text-align: center;">
                <div id="match-status" style="font-size: 10px; color: #444; letter-spacing: 5px;">BATTLE IN PROGRESS</div>
            </div>
            <div class="hud-player">
                <div class="player-label">Core System</div>
                <div id="score-p2" class="score-num" style="color: var(--secondary)">0</div>
            </div>
        </div>

        <div id="announcer">GOAL!</div>
        <div id="notification-box"></div>

        <canvas id="main-arena" width="1000" height="600"></canvas>

        <div id="screen-main" class="screen">
            <div class="panel">
                <h1>KING PONG</h1>
                <p style="letter-spacing: 8px; font-size: 11px; opacity: 0.4; margin-top: -10px;">KING DEV ACADEMY PRO</p>
                <div class="menu-options">
                    <button class="btn-king" onclick="App.UI.show('screen-difficulty')">Single Player</button>
                    <button class="btn-king" style="border-color: var(--secondary);" onclick="App.Logic.initGame('pvp')">Local Versus</button>
                    <div style="font-size: 9px; color: #333; margin-top: 10px;">VERSION 2.0.4 - STABLE BUILD</div>
                </div>
            </div>
        </div>

        <div id="screen-difficulty" class="screen hidden">
            <div class="panel">
                <h2 style="color: var(--primary); letter-spacing: 2px;">SELECT DIFFICULTY</h2>
                <div class="menu-options">
                    <button class="btn-king" onclick="App.Logic.initGame('bot', 0.06, 8)">Novice</button>
                    <button class="btn-king" onclick="App.Logic.initGame('bot', 0.12, 11)">Veteran</button>
                    <button class="btn-king" onclick="App.Logic.initGame('bot', 0.20, 14)">God Mode</button>
                    <button class="btn-king" style="background:transparent; border:none; font-size:10px;" onclick="App.UI.show('screen-main')">Return</button>
                </div>
            </div>
        </div>

        <div id="screen-gameover" class="screen hidden">
            <div class="panel">
                <h2 id="winner-text" style="font-size: 3rem; margin:0;">MATCH ENDED</h2>
                <p id="winner-desc" style="opacity:0.6; margin-bottom: 2rem;"></p>
                <button class="btn-king" onclick="location.reload()">Back to Terminal</button>
            </div>
        </div>

    </div>

    <script>
        /**
         * King Dev Academy - Professional Game Architecture
         * Namespace: App
         */
        const App = {
            // Configurações Globais
            Config: {
                width: 1000,
                height: 600,
                paddleWidth: 15,
                paddleHeight: 110,
                ballSize: 9,
                winScore: 7,
                fps: 60
            },

            // Gerenciador de Áudio Procedural
            Audio: {
                ctx: null,
                init() {
                    if(!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                },
                play(freq, type = 'sine', duration = 0.1, vol = 0.1) {
                    if(!this.ctx) return;
                    const osc = this.ctx.createOscillator();
                    const gain = this.ctx.createGain();
                    osc.type = type;
                    osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                    gain.gain.setValueAtTime(vol, this.ctx.currentTime);
                    gain.gain.exponentialRampToValueAtTime(0.0001, this.ctx.currentTime + duration);
                    osc.connect(gain);
                    gain.connect(this.ctx.destination);
                    osc.start();
                    osc.stop(this.ctx.currentTime + duration);
                }
            },

            // Gerenciador de Interface
            UI: {
                screens: ['screen-main', 'screen-difficulty', 'screen-gameover'],
                show(id) {
                    this.screens.forEach(s => document.getElementById(s).classList.add('hidden'));
                    document.getElementById(id).classList.remove('hidden');
                },
                notify(msg, color = 'var(--success)') {
                    const box = document.getElementById('notification-box');
                    const toast = document.createElement('div');
                    toast.className = 'toast';
                    toast.style.color = color;
                    toast.innerText = msg;
                    box.appendChild(toast);
                    setTimeout(() => toast.remove(), 2000);
                }
            },

            // Lógica do Jogo
            Logic: {
                canvas: null,
                ctx: null,
                active: false,
                mode: 'bot',
                iaLevel: 0.1,
                ballSpeed: 8,
                shake: 0,
                scoreP1: 0,
                scoreP2: 0,
                keys: {},
                particles: [],
                trail: [],

                init() {
                    this.canvas = document.getElementById('main-arena');
                    this.ctx = this.canvas.getContext('2d');
                    this.bindEvents();
                },

                bindEvents() {
                    window.addEventListener('keydown', e => this.keys[e.code] = true);
                    window.addEventListener('keyup', e => this.keys[e.code] = false);
                },

                initGame(mode, difficulty = 0.1, speed = 8) {
                    App.Audio.init(); // Ativa áudio no clique
                    this.mode = mode;
                    this.iaLevel = difficulty;
                    this.ballSpeed = speed;
                    this.scoreP1 = 0;
                    this.scoreP2 = 0;
                    
                    App.UI.show('none');
                    document.getElementById('game-hud').style.display = 'flex';
                    this.canvas.style.display = 'block';
                    
                    this.active = true;
                    this.resetBall();
                    this.loop();
                    App.UI.notify("SYSTEM ONLINE", "var(--primary)");
                },

                resetBall() {
                    this.ball = {
                        x: 500, y: 300,
                        vX: (Math.random() > 0.5 ? 1 : -1) * this.ballSpeed,
                        vY: (Math.random() - 0.5) * 12,
                        speed: this.ballSpeed
                    };
                    this.trail = [];
                    this.p1 = { y: 245 };
                    this.p2 = { y: 245 };
                },

                createFaíscas(x, y, color) {
                    for(let i=0; i<15; i++) {
                        this.particles.push({
                            x, y,
                            vX: (Math.random() - 0.5) * 12,
                            vY: (Math.random() - 0.5) * 12,
                            alpha: 1,
                            color: color
                        });
                    }
                },

                checkCollision(b, p, isLeft) {
                    const px = isLeft ? 40 : 960 - App.Config.paddleWidth;
                    if (b.x + App.Config.ballSize > px && b.x - App.Config.ballSize < px + App.Config.paddleWidth) {
                        if (b.y > p.y && b.y < p.y + App.Config.paddleHeight) {
                            // Cálculo de Ângulo Dinâmico
                            let impact = (b.y - (p.y + App.Config.paddleHeight/2)) / (App.Config.paddleHeight/2);
                            let angle = impact * (Math.PI/4);
                            
                            b.vX = (isLeft ? 1 : -1) * b.speed * Math.cos(angle);
                            b.vY = b.speed * Math.sin(angle);
                            b.speed += 0.4;
                            this.shake = 8;
                            this.createFaíscas(b.x, b.y, isLeft ? 'var(--primary)' : 'var(--secondary)');
                            App.Audio.play(300 + (Math.random()*200), 'square', 0.08, 0.05);
                            return true;
                        }
                    }
                    return false;
                },

                update() {
                    if (!this.active) return;

                    // Player 1 Movement
                    if (this.keys['KeyW'] && this.p1.y > 5) this.p1.y -= 14;
                    if (this.keys['KeyS'] && this.p1.y < 595 - App.Config.paddleHeight) this.p1.y += 14;

                    // Player 2 / AI Movement
                    if (this.mode === 'pvp') {
                        if (this.keys['ArrowUp'] && this.p2.y > 5) this.p2.y -= 14;
                        if (this.keys['ArrowDown'] && this.p2.y < 595 - App.Config.paddleHeight) this.p2.y += 14;
                    } else {
                        let center = this.p2.y + App.Config.paddleHeight/2;
                        this.p2.y += (this.ball.y - center) * this.iaLevel * 9;
                    }

                    // Ball Physics
                    this.ball.x += this.ball.vX;
                    this.ball.y += this.ball.vY;

                    // Wall Bounce
                    if (this.ball.y < 15 || this.ball.y > 585) {
                        this.ball.vY *= -1;
                        this.shake = 4;
                        App.Audio.play(150, 'triangle', 0.05);
                    }

                    // Paddle Collisions
                    this.checkCollision(this.ball, this.p1, true);
                    this.checkCollision(this.ball, this.p2, false);

                    // Trail Logic
                    this.trail.push({ x: this.ball.x, y: this.ball.y });
                    if (this.trail.length > 20) this.trail.shift();

                    // Scoring
                    if (this.ball.x < 0) this.handleGoal(2);
                    if (this.ball.x > App.Config.width) this.handleGoal(1);

                    // Particle cleanup
                    this.particles.forEach((p, i) => {
                        p.x += p.vX; p.y += p.vY; p.alpha -= 0.03;
                        if (p.alpha <= 0) this.particles.splice(i, 1);
                    });

                    // Decay Effects
                    if (this.shake > 0) this.shake *= 0.9;
                },

                handleGoal(p) {
                    if (p === 1) this.scoreP1++; else this.scoreP2++;
                    
                    this.shake = 25;
                    App.Audio.play(80, 'sawtooth', 0.4, 0.2);
                    
                    document.getElementById('score-p1').innerText = this.scoreP1;
                    document.getElementById('score-p2').innerText = this.scoreP2;

                    // Anúncio visual
                    const ann = document.getElementById('announcer');
                    ann.innerText = "GOAL!";
                    ann.style.color = p === 1 ? 'var(--primary)' : 'var(--secondary)';
                    ann.style.opacity = 1;
                    setTimeout(() => ann.style.opacity = 0, 1000);

                    if (this.scoreP1 >= App.Config.winScore || this.scoreP2 >= App.Config.winScore) {
                        this.endGame(p === 1 ? "PLAYER 1" : "PLAYER 2");
                    } else {
                        this.resetBall();
                    }
                },

                endGame(winner) {
                    this.active = false;
                    setTimeout(() => {
                        this.canvas.style.display = 'none';
                        document.getElementById('game-hud').style.display = 'none';
                        App.UI.show('screen-gameover');
                        document.getElementById('winner-text').innerText = winner + " WINS";
                        document.getElementById('winner-text').style.color = winner.includes('1') ? 'var(--primary)' : 'var(--secondary)';
                        document.getElementById('winner-desc').innerText = `Tournament results stored in King Dev Academy database. Score: ${this.scoreP1} - ${this.scoreP2}`;
                    }, 1500);
                },

                draw() {
                    const ctx = this.ctx;
                    ctx.save();
                    
                    // Screen Shake
                    if (this.shake > 0.5) {
                        ctx.translate((Math.random()-0.5)*this.shake, (Math.random()-0.5)*this.shake);
                    }

                    // Background & Glow
                    ctx.fillStyle = '#000';
                    ctx.fillRect(0, 0, 1000, 600);

                    // Campo: Borda e Rede
                    ctx.strokeStyle = 'rgba(255,255,255,0.05)';
                    ctx.lineWidth = 10;
                    ctx.strokeRect(5, 5, 990, 590);

                    ctx.setLineDash([15, 15]);
                    ctx.strokeStyle = 'rgba(255,255,255,0.05)';
                    ctx.beginPath(); ctx.moveTo(500, 10); ctx.lineTo(500, 590); ctx.stroke();
                    ctx.setLineDash([]);

                    // Desenhar Trail (Rastro)
                    this.trail.forEach((t, i) => {
                        let size = (i / this.trail.length) * App.Config.ballSize;
                        ctx.fillStyle = `rgba(255, 255, 255, ${i/30})`;
                        ctx.beginPath();
                        ctx.arc(t.x, t.y, size, 0, Math.PI*2);
                        ctx.fill();
                    });

                    // Paddles com Brilho Dinâmico
                    this.drawPaddle(40, this.p1.y, 'var(--primary)');
                    this.drawPaddle(960 - App.Config.paddleWidth, this.p2.y, 'var(--secondary)');

                    // Ball
                    ctx.shadowBlur = 15; ctx.shadowColor = '#fff';
                    ctx.fillStyle = '#fff';
                    ctx.beginPath();
                    ctx.arc(this.ball.x, this.ball.y, App.Config.ballSize, 0, Math.PI*2);
                    ctx.fill();
                    ctx.shadowBlur = 0;

                    // Particles
                    this.particles.forEach(p => {
                        ctx.globalAlpha = p.alpha;
                        ctx.fillStyle = p.color;
                        ctx.fillRect(p.x, p.y, 4, 4);
                    });
                    ctx.globalAlpha = 1;

                    ctx.restore();
                },

                drawPaddle(x, y, color) {
                    const ctx = this.ctx;
                    ctx.shadowBlur = 20;
                    ctx.shadowColor = color;
                    ctx.fillStyle = color;
                    
                    // Desenho da Raquete arredondada
                    const r = 5; // radius
                    const w = App.Config.paddleWidth;
                    const h = App.Config.paddleHeight;
                    
                    ctx.beginPath();
                    ctx.moveTo(x + r, y);
                    ctx.arcTo(x + w, y, x + w, y + h, r);
                    ctx.arcTo(x + w, y + h, x, y + h, r);
                    ctx.arcTo(x, y + h, x, y, r);
                    ctx.arcTo(x, y, x + w, y, r);
                    ctx.fill();
                    ctx.shadowBlur = 0;
                },

                loop() {
                    if (!this.active) return;
                    this.update();
                    this.draw();
                    requestAnimationFrame(() => this.loop());
                }
            }
        };

        // Auto-inicialização do Engine
        window.onload = () => App.Logic.init();

    </script>
</body>
</html>
