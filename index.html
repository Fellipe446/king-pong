<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>King Dev Academy - Pong Pro</title>
    <style>
        body { background: #000; color: #fff; font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        #game-container { position: relative; border: 4px solid #fff; }
        canvas { display: block; }
        #menu, #game-over { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        button { background: transparent; color: white; border: 2px solid white; padding: 10px 20px; font-family: 'Courier New', monospace; cursor: pointer; margin: 10px; font-size: 18px; }
        button:hover { background: white; color: black; }
        .hidden { display: none !important; }
        .status { position: absolute; top: -40px; width: 100%; text-align: center; font-size: 20px; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="status" id="matchStatus">Melhor de 3 - Partida 1</div>
    <canvas id="pong" width="600" height="400"></canvas>

    <div id="menu">
        <h1>KING PONG</h1>
        <p>King Dev Academy</p>
        <button onclick="startGame('pvp')">1 VS 1 (Teclado W/S e Setas)</button>
        <button onclick="startGame('bot')">1 VS BOT (Use o Mouse)</button>
    </div>

    <div id="game-over" class="hidden">
        <h1 id="winnerTitle">JOGADOR 1 VENCEU!</h1>
        <p id="matchScore">Sets: 0 - 0</p>
        <button onclick="resetMatch()">VOLTAR AO MENU</button>
    </div>
</div>

<script>
    const canvas = document.getElementById("pong");
    const ctx = canvas.getContext("2d");

    // Áudio (Sintetizador)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(freq) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.frequency.value = freq;
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.1);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.1);
    }

    // Configurações
    let gameMode = 'bot'; // 'pvp' ou 'bot'
    let p1Sets = 0, p2Sets = 0;
    const WIN_POINTS = 5;
    const WIN_SETS = 2; // Melhor de 3 (quem fizer 2 primeiro)
    let isPaused = true;

    const ball = { x: 300, y: 200, r: 8, speed: 5, vX: 5, vY: 5 };
    const p1 = { x: 0, y: 150, w: 10, h: 80, score: 0 };
    const p2 = { x: 590, y: 150, w: 10, h: 80, score: 0 };

    // Controles
    const keys = {};
    window.addEventListener("keydown", e => keys[e.keyCode] = true);
    window.addEventListener("keyup", e => keys[e.keyCode] = false);
    canvas.addEventListener("mousemove", e => {
        if(gameMode === 'bot') p1.y = e.clientY - canvas.getBoundingClientRect().top - p1.h/2;
    });

    function startGame(mode) {
        gameMode = mode;
        p1Sets = 0; p2Sets = 0;
        resetSet();
        document.getElementById("menu").classList.add("hidden");
        document.getElementById("game-over").classList.add("hidden");
        isPaused = false;
    }

    function resetSet() {
        p1.score = 0; p2.score = 0;
        resetBall();
        updateMatchStatus();
    }

    function resetBall() {
        ball.x = canvas.width/2; ball.y = canvas.height/2;
        ball.speed = 5;
        ball.vX = (Math.random() > 0.5 ? 1 : -1) * ball.speed;
        ball.vY = (Math.random() > 0.5 ? 1 : -1) * ball.speed;
    }

    function updateMatchStatus() {
        document.getElementById("matchStatus").innerText = `Sets: P1 [${p1Sets}] - P2 [${p2Sets}]`;
    }

    function update() {
        if(isPaused) return;

        // Movimento P1 (Teclado em PvP)
        if(gameMode === 'pvp') {
            if(keys[87] && p1.y > 0) p1.y -= 7; // W
            if(keys[83] && p1.y < canvas.height - p1.h) p1.y += 7; // S
        }

        // Movimento P2 (Bot ou Teclado)
        if(gameMode === 'bot') {
            p2.y += (ball.y - (p2.y + p2.h/2)) * 0.08;
        } else {
            if(keys[38] && p2.y > 0) p2.y -= 7; // Seta Cima
            if(keys[40] && p2.y < canvas.height - p2.h) p2.y += 7; // Seta Baixo
        }

        ball.x += ball.vX; ball.y += ball.vY;

        // Bordas
        if(ball.y + ball.r > canvas.height || ball.y - ball.r < 0) {
            ball.vY *= -1;
            playSound(400);
        }

        let player = (ball.x < canvas.width/2) ? p1 : p2;
        if(collision(ball, player)) {
            playSound(600);
            let collidePoint = (ball.y - (player.y + player.h/2)) / (player.h/2);
            let angle = (Math.PI/4) * collidePoint;
            let dir = (ball.x < canvas.width/2) ? 1 : -1;
            ball.vX = dir * ball.speed * Math.cos(angle);
            ball.vY = ball.speed * Math.sin(angle);
            ball.speed += 0.3;
        }

        // Pontuação
        if(ball.x < 0) { p2.score++; scoreGoal(); }
        else if(ball.x > canvas.width) { p1.score++; scoreGoal(); }
    }

    function collision(b, p) {
        return b.x + b.r > p.x && b.x - b.r < p.x + p.w && b.y + b.r > p.y && b.y - b.r < p.y + p.h;
    }

    function scoreGoal() {
        playSound(200);
        if(p1.score >= WIN_POINTS || p2.score >= WIN_POINTS) {
            if(p1.score >= WIN_POINTS) p1Sets++; else p2Sets++;
            
            if(p1Sets === WIN_SETS || p2Sets === WIN_SETS) {
                endMatch();
            } else {
                resetSet();
            }
        } else {
            resetBall();
        }
    }

    function endMatch() {
        isPaused = true;
        document.getElementById("game-over").classList.remove("hidden");
        document.getElementById("winnerTitle").innerText = p1Sets === WIN_SETS ? "P1 VENCEU O MATCH!" : "P2 VENCEU O MATCH!";
        document.getElementById("matchScore").innerText = `Placar Final: ${p1Sets} a ${p2Sets}`;
    }

    function resetMatch() {
        document.getElementById("menu").classList.remove("hidden");
        document.getElementById("game-over").classList.add("hidden");
    }

    function draw() {
        ctx.fillStyle = "#000";
        ctx.fillRect(0,0,canvas.width, canvas.height);
        
        // Rede
        ctx.strokeStyle = "#fff";
        ctx.setLineDash([10, 10]);
        ctx.beginPath(); ctx.moveTo(canvas.width/2, 0); ctx.lineTo(canvas.width/2, canvas.height); ctx.stroke();
        ctx.setLineDash([]);

        // Placar
        ctx.font = "40px Courier New";
        ctx.fillText(p1.score, canvas.width/4, 50);
        ctx.fillText(p2.score, 3*canvas.width/4, 50);

        ctx.fillStyle = "#fff";
        ctx.fillRect(p1.x, p1.y, p1.w, p1.h);
        ctx.fillRect(p2.x, p2.y, p2.w, p2.h);
        ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2); ctx.fill();
        
        update();
        requestAnimationFrame(draw);
    }

    draw();
</script>
</body>
</html>
