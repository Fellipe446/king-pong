<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>King Dev Academy - Pong Pro Elite</title>
    <style>
        body { background: #000; color: #fff; font-family: 'Courier New', monospace; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        #game-container { position: relative; border: 4px solid #fff; }
        canvas { display: block; }
        #menu, #game-over { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        button { background: transparent; color: white; border: 2px solid white; padding: 10px 20px; font-family: 'Courier New', monospace; cursor: pointer; margin: 5px; font-size: 16px; width: 250px; }
        button:hover { background: white; color: black; }
        .hidden { display: none !important; }
        .status { position: absolute; top: -40px; width: 100%; text-align: center; font-size: 20px; text-transform: uppercase; }
        h1 { font-size: 40px; margin-bottom: 5px; }
        p { margin-bottom: 20px; color: #aaa; }
    </style>
</head>
<body>

<div id="game-container">
    <div class="status" id="matchStatus">Sets: P1 [0] - P2 [0]</div>
    <canvas id="pong" width="600" height="400"></canvas>

    <div id="menu">
        <h1>KING PONG</h1>
        <p>King Dev Academy</p>
        <button onclick="startGame('pvp')">MODO 1 VS 1 (W/S vs SETAS)</button>
        <hr style="width: 50%; border: 1px solid #333; margin: 10px;">
        <button onclick="startGame('bot', 0.05)">VS BOT: FÁCIL</button>
        <button onclick="startGame('bot', 0.1)">VS BOT: MÉDIO</button>
        <button onclick="startGame('bot', 0.2)">VS BOT: DIFÍCIL</button>
    </div>

    <div id="game-over" class="hidden">
        <h1 id="winnerTitle">VENCEDOR!</h1>
        <p id="matchScore">Placar</p>
        <button onclick="resetMatch()">VOLTAR AO MENU</button>
    </div>
</div>

<script>
    const canvas = document.getElementById("pong");
    const ctx = canvas.getContext("2d");

    // Áudio
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playSound(freq) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.frequency.value = freq;
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.1);
        osc.start(); osc.stop(audioCtx.currentTime + 0.1);
    }

    // Configurações Globais
    let gameMode = 'bot'; 
    let botLevel = 0.1;
    let p1Sets = 0, p2Sets = 0;
    const WIN_POINTS = 5;
    const WIN_SETS = 2;
    let isPaused = true;

    const ball = { x: 300, y: 200, r: 8, speed: 5, vX: 5, vY: 5 };
    const p1 = { x: 0, y: 160, w: 10, h: 80, score: 0 };
    const p2 = { x: 590, y: 160, w: 10, h: 80, score: 0 };

    // Teclado
    const keys = {};
    window.addEventListener("keydown", e => keys[e.keyCode] = true);
    window.addEventListener("keyup", e => keys[e.keyCode] = false);

    function startGame(mode, level = 0.1) {
        gameMode = mode;
        botLevel = level;
        p1Sets = 0; p2Sets = 0;
        resetSet();
        document.getElementById("menu").classList.add("hidden");
        document.getElementById("game-over").classList.add("hidden");
        isPaused = false;
    }

    function resetSet() {
        p1.score = 0; p2.score = 0;
        resetBall();
        updateMatchStatus();
    }

    function resetBall() {
        ball.x = canvas.width/2; ball.y = canvas.height/2;
        ball.speed = 5;
        ball.vX = (Math.random() > 0.5 ? 1 : -1) * ball.speed;
        ball.vY = (Math.random() > 0.5 ? 1 : -1) * ball.speed;
    }

    function updateMatchStatus() {
        document.getElementById("matchStatus").innerText = `Sets: P1 [${p1Sets}] - P2 [${p2Sets}]`;
    }

    function update() {
        if(isPaused) return;

        // Controle Jogador 1 (W=87, S=83)
        if(keys[87] && p1.y > 0) p1.y -= 7;
        if(keys[83] && p1.y < canvas.height - p1.h) p1.y += 7;

        // Controle Jogador 2 (BOT ou SETAS: Cima=38, Baixo=40)
        if(gameMode === 'bot') {
            p2.y += (ball.y - (p2.y + p2.h/2)) * botLevel;
        } else {
            if(keys[38] && p2.y > 0) p2.y -= 7;
            if(keys[40] && p2.y < canvas.height - p2.h) p2.y += 7;
        }

        ball.x += ball.vX; ball.y += ball.vY;

        // Colisão Paredes
        if(ball.y + ball.r > canvas.height || ball.y - ball.r < 0) {
            ball.vY *= -1;
            playSound(400);
        }

        let player = (ball.x < canvas.width/2) ? p1 : p2;
        if(collision(ball, player)) {
            playSound(600);
            let collidePoint = (ball.y - (player.y + player.h/2)) / (player.h/2);
            let angle = (Math.PI/4) * collidePoint;
            let dir = (ball.x < canvas.width/2) ? 1 : -1;
            ball.vX = dir * ball.speed * Math.cos(angle);
            ball.vY = ball.speed * Math.sin(angle);
            ball.speed += 0.4; // Aceleração gradual
        }

        // Gols
        if(ball.x < 0) { p2.score++; checkScore(); }
        else if(ball.x > canvas.width) { p1.score++; checkScore(); }
    }

    function collision(b, p) {
        return b.x + b.r > p.x && b.x - b.r < p.x + p.w && b.y + b.r > p.y && b.y - b.r < p.y + p.h;
    }

    function checkScore() {
        playSound(200);
        if(p1.score >= WIN_POINTS || p2.score >= WIN_POINTS) {
            if(p1.score >= WIN_POINTS) p1Sets++; else p2Sets++;
            
            if(p1Sets === WIN_SETS || p2Sets === WIN_SETS) {
                endMatch();
            } else {
                alert("Set Finalizado! Iniciando próximo set...");
                resetSet();
            }
        } else {
            resetBall();
        }
    }

    function endMatch() {
        isPaused = true;
        document.getElementById("game-over").classList.remove("hidden");
        document.getElementById("winnerTitle").innerText = p1Sets === WIN_SETS ? "P1 É O CAMPEÃO!" : "P2 É O CAMPEÃO!";
        document.getElementById("matchScore").innerText = `Sets Finalizados: ${p1Sets} a ${p2Sets}`;
    }

    function resetMatch() {
        document.getElementById("menu").classList.remove("hidden");
        document.getElementById("game-over").classList.add("hidden");
    }

    function draw() {
        ctx.fillStyle = "#000"; ctx.fillRect(0,0,canvas.width, canvas.height);
        
        // Rede Central
        ctx.strokeStyle = "#333"; ctx.setLineDash([10, 10]);
        ctx.beginPath(); ctx.moveTo(canvas.width/2, 0); ctx.lineTo(canvas.width/2, canvas.height); ctx.stroke();
        ctx.setLineDash([]);

        // Placar Pontos
        ctx.fillStyle = "#555"; ctx.font = "60px Courier New";
        ctx.fillText(p1.score, canvas.width/4 - 20, 80);
        ctx.fillText(p2.score, 3*canvas.width/4 - 20, 80);

        // Elementos
        ctx.fillStyle = "#fff";
        ctx.fillRect(p1.x, p1.y, p1.w, p1.h);
        ctx.fillRect(p2.x, p2.y, p2.w, p2.h);
        ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2); ctx.fill();
        
        update();
        requestAnimationFrame(draw);
    }
    draw();
</script>
</body>
</html>
