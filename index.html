<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>King Dev Academy - Pong Ultimate</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root { --neon-blue: #00d2ff; --neon-pink: #ff007f; --neon-green: #39ff14; }
        body { background: #050505; color: #fff; font-family: 'Courier New', Courier, monospace; margin: 0; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; touch-action: none; }
        
        #menu-container { background: rgba(10, 10, 10, 0.95); padding: 30px; border: 2px solid var(--neon-blue); border-radius: 15px; text-align: center; box-shadow: 0 0 30px rgba(0, 210, 255, 0.2); z-index: 100; max-width: 400px; width: 90%; }
        
        h1 { font-size: 2.2em; color: var(--neon-blue); text-shadow: 0 0 10px var(--neon-blue); margin: 0; }
        .brand { font-size: 0.8em; color: var(--neon-pink); letter-spacing: 3px; margin-bottom: 25px; }
        
        .section { display: none; flex-direction: column; gap: 12px; }
        .active { display: flex; }

        button { background: transparent; color: #fff; border: 1px solid #444; padding: 12px; cursor: pointer; transition: 0.3s; text-transform: uppercase; font-weight: bold; border-radius: 4px; }
        button:hover:not(:disabled) { background: var(--neon-blue); color: #000; box-shadow: 0 0 15px var(--neon-blue); border-color: var(--neon-blue); }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-multi { border-color: var(--neon-pink); color: var(--neon-pink); }
        
        #id-box { background: #1a1a1a; padding: 15px; margin: 10px 0; border: 1px dashed var(--neon-green); color: var(--neon-green); font-size: 1.1em; }
        
        /* Animação de carregando */
        .loading-dots:after { content: ' .'; animation: dots 1s steps(5, end) infinite;}
        @keyframes dots { 0%, 20% { content: ' .'; } 40% { content: ' ..'; } 60% { content: ' ...'; } 80%, 100% { content: ''; } }

        canvas { border: 2px solid #222; background: #000; display: none; max-width: 95vw; max-height: 85vh; }
    </style>
</head>
<body>

    <div id="menu-container">
        <h1>PONG ELITE</h1>
        <div class="brand">KING DEV ACADEMY</div>

        <div id="main-menu" class="section active">
            <button onclick="showSection('bot-menu')">Jogar vs BOT</button>
            <button onclick="startGame('pvp')">Local 1 VS 1</button>
            <button class="btn-multi" onclick="showSection('multi-menu')">Online Multiplayer</button>
        </div>

        <div id="bot-menu" class="section">
            <button onclick="startGame('bot', 0.05, 5)">Fácil</button>
            <button onclick="startGame('bot', 0.1, 8)">Médio</button>
            <button onclick="startGame('bot', 0.2, 12)">Impossível</button>
            <button style="font-size: 10px;" onclick="showSection('main-menu')">Voltar</button>
        </div>

        <div id="multi-menu" class="section">
            <div id="id-box">SEU ID: <span id="my-id" class="loading-dots">CONECTANDO AO SERVIDOR</span></div>
            <p id="server-msg" style="font-size: 10px; color: #666;">O servidor gratuito do Render demora ~1min para acordar.</p>
            <input type="number" id="targetID" placeholder="ID DO AMIGO" style="padding:10px; background:#000; border:1px solid #333; color:#fff; text-align:center;">
            <button id="inviteBtn" class="btn-multi" onclick="sendInvite()" disabled>Convidar Amigo</button>
            <button style="font-size: 10px;" onclick="showSection('main-menu')">Voltar</button>
        </div>
    </div>

    <canvas id="pong" width="800" height="500"></canvas>

    <script>
        // Tenta conectar e manter a conexão
        const socket = io({
            reconnection: true,
            reconnectionAttempts: 10,
            reconnectionDelay: 1000
        });

        const canvas = document.getElementById("pong");
        const ctx = canvas.getContext("2d");
        let myID, currentRoom, isHost = false, gameMode = 'bot';

        // Interface do Menu
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        // Quando o ID finalmente chega
        socket.on('myID', id => {
            myID = id;
            const idSpan = document.getElementById('my-id');
            idSpan.innerText = id;
            idSpan.classList.remove('loading-dots');
            document.getElementById('inviteBtn').disabled = false;
            document.getElementById('server-msg').innerText = "Servidor Online!";
            document.getElementById('server-msg').style.color = "var(--neon-green)";
        });

        socket.on('connect_error', () => {
            document.getElementById('my-id').innerText = "ACORDANDO SERVIDOR";
        });

        // Lógica de Jogo
        const ball = { x: 400, y: 250, r: 8, vX: 6, vY: 6, speed: 6 };
        const p1 = { y: 210, h: 80, w: 12, score: 0 }; 
        const p2 = { y: 210, h: 80, w: 12, score: 0 };

        function sendInvite() {
            const tid = document.getElementById('targetID').value;
            if(tid) socket.emit('invitePlayer', tid.toString());
        }

        socket.on('receiveInvite', (fromID) => {
            if(confirm("Aceitar convite do ID: " + fromID + "?")) socket.emit('acceptInvite', fromID);
        });

        socket.on('gameStart', (data) => {
            currentRoom = data.room;
            isHost = (socket.id === data.host);
            gameMode = 'multiplayer';
            document.getElementById('menu-container').style.display = 'none';
            canvas.style.display = 'block';
            resetBall();
            loop();
        });

        // Loop básico para teste
        function loop() {
            ctx.fillStyle = "#000"; ctx.fillRect(0,0,800,500);
            ctx.fillStyle = "#fff"; ctx.fillRect(10, p1.y, 10, 80);
            ctx.fillStyle = "#fff"; ctx.fillRect(780, p2.y, 10, 80);
            ctx.beginPath(); ctx.arc(ball.x, ball.y, 8, 0, Math.PI*2); ctx.fill();
            requestAnimationFrame(loop);
        }

        function resetBall() { ball.x = 400; ball.y = 250; }
        
        // Movimento (Touch/Mouse)
        canvas.addEventListener('mousemove', e => {
            const rect = canvas.getBoundingClientRect();
            p1.y = (e.clientY - rect.top) * (500 / rect.height) - 40;
            if(gameMode === 'multiplayer') socket.emit('updatePos', { room: currentRoom, y: p1.y });
        });
        socket.on('opponentPos', d => p2.y = d.y);
    </script>
</body>
</html>
