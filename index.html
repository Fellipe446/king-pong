<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KING PONG | ULTIMATE EDITION</title>
    <style>
        :root {
            --p1-neon: #00d2ff;
            --p2-neon: #ff007f;
            --court-line: rgba(255, 255, 255, 0.2);
            --bg-dark: #020202;
        }

        body {
            background: var(--bg-dark);
            color: #fff;
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
            touch-action: none;
        }

        /* --- UI MODERNA --- */
        #ui-layer {
            position: absolute;
            width: 1000px;
            height: 600px;
            pointer-events: none;
            display: none;
            z-index: 10;
        }

        .score-board {
            display: flex;
            justify-content: space-between;
            padding: 20px 60px;
            font-size: 5rem;
            font-weight: 900;
            text-shadow: 0 0 20px rgba(255,255,255,0.2);
        }

        /* --- MENUS --- */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.85);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .panel {
            background: #0a0a0a;
            padding: 3rem;
            border-radius: 2rem;
            border: 2px solid #222;
            text-align: center;
            width: 350px;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        .btn-king {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: #111;
            border: 1px solid #333;
            color: #fff;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            text-transform: uppercase;
        }

        .btn-king:hover {
            background: #fff;
            color: #000;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(255,255,255,0.2);
        }

        canvas {
            background: #000;
            box-shadow: 0 0 100px rgba(0,0,0,0.5);
            border: 2px solid #111;
            border-radius: 8px;
            display: none;
        }

        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="menu-main" class="overlay">
        <div class="panel">
            <h1 style="font-size: 3rem; margin:0; background: linear-gradient(to right, var(--p1-neon), var(--p2-neon)); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">KING PONG</h1>
            <p style="letter-spacing: 5px; opacity: 0.5; font-size: 10px; margin-bottom: 2rem;">ULTIMATE EDITION</p>
            <button class="btn-king" onclick="nav('menu-ia')">Player vs Bot</button>
            <button class="btn-king" onclick="nav('menu-pvp')">Local Multiplayer</button>
        </div>
    </div>

    <div id="menu-ia" class="overlay hidden">
        <div class="panel">
            <h2>NÍVEL IA</h2>
            <button class="btn-king" onclick="start('bot', 0.05)">Iniciante</button>
            <button class="btn-king" onclick="start('bot', 0.10)">Veterano</button>
            <button class="btn-king" onclick="start('bot', 0.18)">Imbatível</button>
        </div>
    </div>

    <div id="ui-layer">
        <div class="score-board">
            <div id="p1-score" style="color: var(--p1-neon)">0</div>
            <div id="p2-score" style="color: var(--p2-neon)">0</div>
        </div>
    </div>
    <canvas id="arena" width="1000" height="600"></canvas>

    <script>
        const canvas = document.getElementById('arena');
        const ctx = canvas.getContext('2d');
        const ui = document.getElementById('ui-layer');

        // --- ENGINE DE ÁUDIO (Web Audio API) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTone(freq, type, duration) {
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        // --- VARIÁVEIS DE JOGO ---
        let gameActive = false, mode = 'bot', diff = 0.05;
        let p1Score = 0, p2Score = 0;
        let shake = 0;
        const keys = {};
        const particles = [];
        const trail = [];

        const ball = {
            x: 500, y: 300, r: 8, vX: 0, vY: 0, speed: 10,
            reset() {
                this.x = 500; this.y = 300; this.speed = 10;
                this.vX = (Math.random() > 0.5 ? 1 : -1) * this.speed;
                this.vY = (Math.random() - 0.5) * 10;
                trail.length = 0;
            }
        };

        const p1 = { y: 250, w: 15, h: 100, color: '#00d2ff' };
        const p2 = { y: 250, w: 15, h: 100, color: '#ff007f' };

        // --- SISTEMA DE PARTÍCULAS ---
        function createParticles(x, y, color) {
            for(let i=0; i<10; i++) {
                particles.push({
                    x, y, 
                    vX: (Math.random()-0.5)*10, 
                    vY: (Math.random()-0.5)*10, 
                    life: 1, 
                    color
                });
            }
        }

        // --- CONTROLES ---
        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        function nav(id) {
            document.querySelectorAll('.overlay').forEach(el => el.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function start(m, d) {
            mode = m; diff = d;
            nav('none');
            canvas.style.display = 'block';
            ui.style.display = 'block';
            gameActive = true;
            ball.reset();
            requestAnimationFrame(loop);
        }

        function update() {
            if(!gameActive) return;

            // Movimento P1
            if(keys['KeyW'] && p1.y > 0) p1.y -= 12;
            if(keys['KeyS'] && p1.y < 500) p1.y += 12;

            // Movimento P2 (IA)
            if(mode === 'bot') {
                p2.y += (ball.y - (p2.y + 50)) * diff * 10;
            }

            // Bola
            ball.x += ball.vX; ball.y += ball.vY;

            // Rastro
            trail.push({x: ball.x, y: ball.y});
            if(trail.length > 15) trail.shift();

            // Colisão Teto/Chão
            if(ball.y < 10 || ball.y > 590) {
                ball.vY *= -1;
                shake = 5;
                playTone(200, 'triangle', 0.1);
            }

            // Colisão Raquetes
            let paddle = (ball.x < 500) ? p1 : p2;
            let px = (ball.x < 500) ? 30 : 970 - 15;

            if(ball.x + ball.r > px && ball.x - ball.r < px + 15 && ball.y > paddle.y && ball.y < paddle.y + 100) {
                let impact = (ball.y - (paddle.y + 50)) / 50;
                let angle = impact * (Math.PI/4);
                ball.vX = (ball.x < 500 ? 1 : -1) * ball.speed * Math.cos(angle);
                ball.vY = ball.speed * Math.sin(angle);
                ball.speed += 0.5;
                shake = 10;
                createParticles(ball.x, ball.y, paddle.color);
                playTone(440, 'square', 0.1);
            }

            // Gols
            if(ball.x < 0) { p2Score++; ball.reset(); playTone(100, 'sawtooth', 0.5); }
            if(ball.x > 1000) { p1Score++; ball.reset(); playTone(100, 'sawtooth', 0.5); }

            document.getElementById('p1-score').innerText = p1Score;
            document.getElementById('p2-score').innerText = p2Score;

            // Partículas Update
            particles.forEach((p, i) => {
                p.x += p.vX; p.y += p.vY; p.life -= 0.02;
                if(p.life <= 0) particles.splice(i, 1);
            });

            if(shake > 0) shake *= 0.9;
        }

        function draw() {
            ctx.save();
            if(shake > 1) ctx.translate((Math.random()-0.5)*shake, (Math.random()-0.5)*shake);
            
            ctx.fillStyle = '#000';
            ctx.fillRect(0, 0, 1000, 600);

            // Linha de Campo Central
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.setLineDash([10, 10]);
            ctx.beginPath(); ctx.moveTo(500,0); ctx.lineTo(500,600); ctx.stroke();
            ctx.setLineDash([]);

            // Desenhar Rastro
            trail.forEach((t, i) => {
                ctx.fillStyle = `rgba(255,255,255, ${i/20})`;
                ctx.beginPath(); ctx.arc(t.x, t.y, ball.r * (i/15), 0, Math.PI*2); ctx.fill();
            });

            // Raquetes
            ctx.shadowBlur = 15;
            ctx.fillStyle = p1.color; ctx.shadowColor = p1.color;
            ctx.fillRect(30, p1.y, 15, 100);
            
            ctx.fillStyle = p2.color; ctx.shadowColor = p2.color;
            ctx.fillRect(955, p2.y, 15, 100);

            // Bola
            ctx.fillStyle = '#fff'; ctx.shadowColor = '#fff';
            ctx.beginPath(); ctx.arc(ball.x, ball.y, ball.r, 0, Math.PI*2); ctx.fill();
            ctx.shadowBlur = 0;

            // Partículas
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.fillRect(p.x, p.y, 3, 3);
            });
            ctx.globalAlpha = 1;

            ctx.restore();
        }

        function loop() {
            if(!gameActive) return;
            update();
            draw();
            requestAnimationFrame(loop);
        }
    </script>
</body>
</html>
